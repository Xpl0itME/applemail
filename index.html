<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Single Page Cross-Window Keystrokes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    button {
      padding: 8px;
      font-size: 14px;
    }
    .log {
      margin-top: 15px;
      padding: 10px;
      border: 1px solid #ccc;
      height: 160px;
      overflow-y: auto;
      background: #f9f9f9;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>

<h2>Main Page</h2>

<button onclick="openTypingWindow()">Open typing window</button>

<div class="log" id="log">Keystrokes:\n</div>

<script>
  const log = document.getElementById("log");

  function openTypingWindow() {
    const win = window.open("", "", "width=400,height=250");

    if (!win) {
      alert("Popup blocked");
      return;
    }

    win.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Typing Window</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 20px; }
          input { width: 100%; padding: 8px; font-size: 14px; }
        </style>
      </head>
      <body>
        <h3>Type here</h3>
        <input id="box" placeholder="Type something" autofocus />
        <script>
          const box = document.getElementById("box");
          box.addEventListener("keydown", (e) => {
            if (window.opener) {
              window.opener.postMessage(
                { key: e.key, code: e.code },
                "*"
              );
            }
          });
        <\/script>
      </body>
      </html>
    `);

    win.document.close();
  }

  window.addEventListener("message", (event) => {
    if (!event.data || !event.data.key) return;

    log.textContent +=
      'key="' + event.data.key + '" code="' + event.data.code + '"\n';

    log.scrollTop = log.scrollHeight;
  });
</script>

</body>
</html>
